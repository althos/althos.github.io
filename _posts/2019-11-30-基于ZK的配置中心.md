---

layout:     post
title:      基于ZK的配置中心
subtitle:   利用zk特性做配置中心
date:       2019-08-30
author:      cyber
header-img: img/tag-bg-o.jpg
catalog: true
tags:
      - 中间中间件
      - zookeeper
---



>现在配置系统越来越分布，配置也越来越难维护，然后

## 配置中心的必要

- 分布式节点维护成本高（比如有你有几十个的服务器，每次加个配置，你得改几十台？）

- 安全性问题（如果你公司有个三方发短信的账号被开发拿去自己用了？或者快递商的月结卡号之类的被窃取？）

- 热启动（你想变动一个配置项，但是必须的重启？）


## 市面上的开源产品

- [Apollo](<https://gitee.com/lepdou/apollo/>)，携程，比较复杂,虽然功能全面,涉及到机房、分区域做配置管理

- Diamond，淘宝，开源版本太过简陋了,前端还是黑白界面,阿里早就不维护了

- Disconf，百度，**依靠zookeeper的Watch机制来做配置**

- Spring Cloud Config，Spring家庭包

- [nacos](<https://nacos.io/en-us/>)，阿里，支持几乎所有主流类型的服务的发现、配置和管理（江湖传言）


## Zookeeper通俗认知

**官方定义：**用程序协调服务，是Google的Chubby一个开源的实现，是Hadoop和Hbase的重要组件。它是一个为分布式应用提供一致性服务的软件，提供的功能包括：配置维护、域名服务、分布式同步、组服务等。

**误区：**很多是时候很多时候我们用zk是连同hadoop啊，dubbo，kafka去用的，所以很多时候我们都是以一个中间件的方式去认知它，具体没有关心它是个啥和本身的特性，之后得到一个**协调服务**去描述这个中间件，没有一个直观的认知。

通俗理解：**数据库**，一个树状的文件系统，里面有个叫znode的概念，可以把它理解为文件夹，**类比mysql中的表**，文件夹里面可以放数据，也能够创建新的文件夹。

## 配置中心问题

上面讲了配置中心的问题，其实只要把配置项放到数据库里面去读，不就变成了一个中心了嘛。但是问题是，在不知道配置文件什么时候有更新的情况下，就得不断去轮询，这就是个很耗性能的事情了。最好的方式是：我的数据库更变了，立马就去告知你就好了。

然后zookeeper的Watch机制就可以满足条件。

## zookeeper的Watch机制

已知zookeeper里面有很多文件节点，然后我们用zk客户端与服务端建立一个长连接，去监听这个文件节点，当文件节点更变的时候，服务器将文件节点的变动的信息给到客户端，然后就去获取这个文件节点的内容。那，你的节点里面存放你的配置信息，不就好了嘛。

### 代码

过后更新

### 相关下载

- [zookeeper下载](http://archive.apache.org/dist/zookeeper/)

- [zukui](https://github.com/althos/zkui),  zk的一个桌面操作系统，这是我拉下的分支，优化了下，解决了下冲突的，编译的jar在resources/jar下面，本地zk端口2181，系统的端口9090























